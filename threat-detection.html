<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSOC  - Threat Detection</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230b1220'/%3E%3Cpath d='M32 8l18 6v12c0 12-8 22-18 26C22 48 14 38 14 26V14l18-6z' fill='%236463f7'/%3E%3C/svg%3E" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="stylesheet" href="assets/shared-buttons.css">
    <link rel="stylesheet" href="assets/chatbot.css">
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        :root { --sidebar-width: 16rem; --sidebar-width-collapsed: 4.5rem; --sidebar-transition-duration: 300ms; --sidebar-transition-ease: ease-in-out; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #d1d5db;
            overflow-x: hidden;
            transition: padding-left var(--sidebar-transition-duration) var(--sidebar-transition-ease);
        }
        /* Animated background particles */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        .card {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(55, 65, 81, 0.3);
            border-radius: 0.75rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .glow-effect {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        .threat-indicator {
            position: relative;
            overflow: hidden;
        }
        .threat-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: scan 3s infinite;
        }
        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        .table-header {
            background-color: #374151;
            color: #d1d5db;
        }
        .table-row:hover {
            background-color: #374151;
        }
        .severity-high { background-color: #991b1b; color: #fecaca; }
        .severity-medium { background-color: #9a3412; color: #fdba74; }
        .severity-low { background-color: #92400e; color: #fde68a; }
        /* Sidebar state */
        body.desktop-with-sidebar { padding-left: var(--sidebar-width); }
        body.desktop-with-sidebar-collapsed { padding-left: var(--sidebar-width-collapsed); }
        #sidebar { width: var(--sidebar-width); transition: width var(--sidebar-transition-duration) var(--sidebar-transition-ease), transform var(--sidebar-transition-duration) var(--sidebar-transition-ease); }
        #sidebar.collapsed { width: var(--sidebar-width-collapsed); }
        #sidebar.collapsed nav a { justify-content: center; gap: 0; }
        #sidebar.collapsed nav a span.text-sm { display: none; }
        #sidebar.collapsed .brand-text { display: none; }
        body.sidebar-modal-open { overflow: hidden; }
        /* Sidebar link styling */
        #sidebar nav a.sidebar-link { position: relative; transition: background-color var(--sidebar-transition-duration) var(--sidebar-transition-ease), color var(--sidebar-transition-duration) var(--sidebar-transition-ease), transform 150ms ease; border-radius: 0.5rem; }
        #sidebar nav a.sidebar-link::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; border-top-left-radius: 6px; border-bottom-left-radius: 6px; background: linear-gradient(180deg, rgba(99,102,241,0.8), rgba(147,51,234,0.8)); opacity: 0; transform: scaleY(0.4); transition: opacity var(--sidebar-transition-duration) var(--sidebar-transition-ease), transform var(--sidebar-transition-duration) var(--sidebar-transition-ease); }
        #sidebar nav a.sidebar-link:hover::before, #sidebar nav a.sidebar-link.active::before { opacity: 1; transform: scaleY(1); }
        #sidebar nav a.sidebar-link:hover { background: rgba(30, 41, 59, 0.8); }
        #sidebar nav a.sidebar-link.active { background: rgba(30, 41, 59, 0.95); color: #fff; }
        #sidebar nav a.sidebar-link .sidebar-icon { transition: color var(--sidebar-transition-duration) var(--sidebar-transition-ease), transform 150ms ease; color: #94a3b8; }
        #sidebar nav a.sidebar-link:hover .sidebar-icon, #sidebar nav a.sidebar-link.active .sidebar-icon { color: #fff; transform: translateX(1px); }
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <!-- Include same sidebar structure as index.html -->
    <button id="sidebar-mobile-toggle" class="lg:hidden fixed top-3 left-3 z-50 inline-flex items-center justify-center rounded-md p-2 text-slate-200 bg-slate-900/90 border border-slate-800 hover:bg-slate-800 transition" aria-controls="sidebar" aria-expanded="false" aria-label="Open sidebar">
        <i class="fas fa-bars"></i>
    </button>
    <div id="sidebar-overlay" class="hidden lg:hidden fixed inset-0 z-40 bg-black/40"></div>
    <aside id="sidebar" class="fixed z-50 top-0 left-0 h-screen bg-slate-900 text-slate-200 border-r border-slate-800 transform -translate-x-full lg:translate-x-0" role="dialog" aria-modal="true" aria-label="Sidebar">
        <div class="flex items-center justify-between px-4 py-4 border-b border-slate-800">
            <div class="flex items-center gap-3 min-w-0">
                <div class="h-9 w-9 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold shadow-inner">◆</div>
                <span class="brand-text text-sm font-semibold truncate hidden sm:block">SmartSOC</span>
            </div>
            <button id="sidebar-collapse-toggle" class="hidden lg:inline-flex items-center justify-center rounded-md p-2 text-slate-300 hover:bg-slate-800 transition" aria-controls="sidebar" aria-expanded="true" aria-label="Collapse sidebar">
                <i id="sidebar-collapse-icon-top" class="fas fa-angle-left"></i>
            </button>
            <button id="sidebar-close" class="lg:hidden inline-flex items-center justify-center rounded-md p-2 text-slate-300 hover:bg-slate-800 transition" aria-label="Close sidebar">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="px-2 py-3 overflow-y-auto h-[calc(100vh-3.25rem)]">
            <ul class="space-y-1">
                <li><a href="index.html" class="sidebar-link group flex items-center gap-3 rounded-md px-3 py-2 text-slate-300"><i class="sidebar-icon fas fa-gauge-high w-5"></i><span class="truncate text-sm font-medium">Dashboard</span></a></li>
                <li><a href="threat-detection.html" class="sidebar-link group flex items-center gap-3 rounded-md px-3 py-2 text-white bg-slate-800" style="box-shadow: inset 3px 0 0 0 rgb(99 102 241)"><i class="sidebar-icon fas fa-triangle-exclamation w-5"></i><span class="truncate text-sm font-medium">Threat Detection</span></a></li>
                <li><a href="cases.html" class="sidebar-link group flex items-center gap-3 rounded-md px-3 py-2 text-slate-300"><i class="sidebar-icon fas fa-fire w-5"></i><span class="truncate text-sm font-medium">Incidents</span></a></li>
                <li><a href="threat-intel.html" class="sidebar-link group flex items-center gap-3 rounded-md px-3 py-2 text-slate-300"><i class="sidebar-icon fas fa-brain w-5"></i><span class="truncate text-sm font-medium">Threat Intel</span></a></li>
                <li><a href="analytics.html" class="sidebar-link group flex items-center gap-3 rounded-md px-3 py-2 text-slate-300"><i class="sidebar-icon fas fa-chart-line w-5"></i><span class="truncate text-sm font-medium">Analytics</span></a></li>
                <li><a href="assets.html" class="sidebar-link group flex items-center gap-3 rounded-md px-3 py-2 text-slate-300"><i class="sidebar-icon fas fa-users w-5"></i><span class="truncate text-sm font-medium">Users</span></a></li>
                <li><a href="settings.html" class="sidebar-link group flex items-center gap-3 rounded-md px-3 py-2 text-slate-300"><i class="sidebar-icon fas fa-gear w-5"></i><span class="truncate text-sm font-medium">Settings</span></a></li>
            </ul>
        </nav>
        <div class="hidden lg:flex absolute bottom-0 left-0 right-0 p-2 border-t border-slate-800">
            <button id="sidebar-collapse-toggle-bottom" class="w-full inline-flex items-center justify-center gap-2 rounded-md px-2 py-2 text-xs text-slate-300 hover:bg-slate-800 transition" aria-controls="sidebar" aria-expanded="true" aria-label="Collapse sidebar">
                <i id="sidebar-collapse-icon-bottom" class="fas fa-angle-left"></i>
            </button>
        </div>
    </aside>

    <div id="particles-js" style="position:fixed; inset:0; z-index:-1"></div>
    <div id="main-container" class="max-w-7xl mx-auto relative z-10">
        <header class="flex items-center justify-between mb-8">
            <h1 class="text-2xl font-bold text-white">Threat Detection</h1>
            <a href="index.html" class="text-sm text-slate-300 hover:underline">Back to Dashboard</a>
        </header>
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Live Alerts Stream -->
            <section class="lg:col-span-2 card p-6 bg-gray-800/80 border border-gray-700 rounded-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold text-white">Live Alerts</h2>
                    <div class="flex items-center gap-2 text-xs text-slate-300">
                        <span id="td-updated" class="text-blue-300">loading…</span>
                        <button id="td-refresh" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">Refresh</button>
                    </div>
                </div>
                <div id="alerts-list" class="space-y-2 max-h-[28rem] overflow-y-auto"></div>
            </section>

            <!-- Detection Controls / Filters -->
            <aside class="card p-6 bg-gray-800/80 border border-gray-700 rounded-lg">
                <h2 class="text-xl font-semibold text-white mb-4">Controls</h2>
                <div class="space-y-3 text-sm text-slate-300">
                    <label class="flex items-center gap-2"><input id="f-high" type="checkbox" class="accent-red-500" checked> High</label>
                    <label class="flex items-center gap-2"><input id="f-medium" type="checkbox" class="accent-orange-500" checked> Medium</label>
                    <label class="flex items-center gap-2"><input id="f-low" type="checkbox" class="accent-yellow-500" checked> Low</label>
                    <button id="f-apply" class="mt-2 bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded">Apply Filters</button>
                </div>
            </aside>
        </main>
    </div>

    <script>
        (function(){
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const mobileToggle = document.getElementById('sidebar-mobile-toggle');
            const closeBtn = document.getElementById('sidebar-close');
            const collapseTop = document.getElementById('sidebar-collapse-toggle');
            const collapseBottom = document.getElementById('sidebar-collapse-toggle-bottom');
            const STORAGE_KEY = 'smartsoc.sidebar.collapsed';
            let collapsed = false;
            try { const persisted = localStorage.getItem(STORAGE_KEY); if (persisted !== null) collapsed = persisted === 'true'; } catch(e) {}
            function applyCollapsedState(){
                const isDesktop = window.innerWidth >= 1024;
                if (isDesktop) {
                    document.body.classList.add('desktop-with-sidebar');
                    document.body.classList.toggle('desktop-with-sidebar-collapsed', collapsed);
                    sidebar.classList.toggle('collapsed', collapsed);
                    const topIcon = document.getElementById('sidebar-collapse-icon-top');
                    const botIcon = document.getElementById('sidebar-collapse-icon-bottom');
                    const expanded = !collapsed;
                    collapseTop && collapseTop.setAttribute('aria-expanded', String(expanded));
                    collapseBottom && collapseBottom.setAttribute('aria-expanded', String(expanded));
                    if (topIcon) topIcon.className = expanded ? 'fas fa-angle-left' : 'fas fa-angle-right';
                    if (botIcon) botIcon.className = expanded ? 'fas fa-angle-left' : 'fas fa-angle-right';
                } else {
                    document.body.classList.remove('desktop-with-sidebar');
                    document.body.classList.remove('desktop-with-sidebar-collapsed');
                    sidebar.classList.remove('collapsed');
                }
            }
            function setCollapsed(next){ collapsed = next; try{localStorage.setItem(STORAGE_KEY, String(collapsed));}catch(e){} applyCollapsedState(); }
            function openMobile(){ sidebar.classList.remove('-translate-x-full'); overlay.classList.remove('hidden'); document.body.classList.add('sidebar-modal-open'); mobileToggle && mobileToggle.setAttribute('aria-expanded','true'); closeBtn && closeBtn.focus && closeBtn.focus(); }
            function closeMobile(){ sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden'); document.body.classList.remove('sidebar-modal-open'); mobileToggle && mobileToggle.setAttribute('aria-expanded','false'); mobileToggle && mobileToggle.focus && mobileToggle.focus(); }
            mobileToggle && mobileToggle.addEventListener('click', openMobile);
            overlay && overlay.addEventListener('click', closeMobile);
            closeBtn && closeBtn.addEventListener('click', closeMobile);
            const toggle = ()=> setCollapsed(!collapsed);
            collapseTop && collapseTop.addEventListener('click', toggle);
            collapseBottom && collapseBottom.addEventListener('click', toggle);
            document.addEventListener('keydown', (e)=>{ if((e.key==='Escape'||e.key==='Esc') && window.innerWidth<1024 && !sidebar.classList.contains('-translate-x-full')){ closeMobile(); } });
            function init(){ if (window.innerWidth >= 1024){ sidebar.classList.remove('-translate-x-full'); overlay.classList.add('hidden'); } else { document.body.classList.remove('desktop-with-sidebar'); document.body.classList.remove('desktop-with-sidebar-collapsed'); sidebar.classList.remove('collapsed'); } applyCollapsedState(); }
            init();
            // Active link highlighting
            (function markActiveLinks(){
                const links = sidebar.querySelectorAll('nav a');
                const current = location.pathname.split('/').pop();
                links.forEach(a => {
                    const href = a.getAttribute('href') || '';
                    const file = href.split('/').pop();
                    const isActive = file === '' ? current === '' : current === file;
                    a.classList.toggle('active', isActive);
                    if (isActive) {
                        a.style.boxShadow = 'inset 3px 0 0 0 rgb(99 102 241)';
                        a.classList.add('text-white');
                        a.classList.add('bg-slate-800');
                    }
                });
            })();
            // Keyboard navigation and collapsed tooltips
            (function enhanceA11y(){
                const navLinks = Array.from(sidebar.querySelectorAll('nav a'));
                sidebar.addEventListener('keydown', (e) => {
                    if (!['ArrowDown','ArrowUp','Home','End'].includes(e.key)) return;
                    const active = document.activeElement;
                    const idx = navLinks.indexOf(active);
                    let nextIdx = idx;
                    if (e.key === 'ArrowDown') nextIdx = Math.min(navLinks.length-1, idx + 1);
                    if (e.key === 'ArrowUp') nextIdx = Math.max(0, idx - 1);
                    if (e.key === 'Home') nextIdx = 0;
                    if (e.key === 'End') nextIdx = navLinks.length - 1;
                    if (nextIdx !== idx && navLinks[nextIdx]) {
                        e.preventDefault();
                        navLinks[nextIdx].focus();
                    }
                });
                function syncCollapsedTooltips() {
                    const isCollapsed = sidebar.classList.contains('collapsed') && window.innerWidth >= 1024;
                    navLinks.forEach(a => {
                        const label = (a.textContent || '').trim();
                        if (isCollapsed) a.setAttribute('title', label);
                        else a.removeAttribute('title');
                    });
                }
                syncCollapsedTooltips();
                window.addEventListener('resize', syncCollapsedTooltips);
            })();
            window.addEventListener('resize', applyCollapsedState);
            // Detection logic (mocked from analytics):
            const MOCK_ALERTS = Array.from({length: 25}).map((_,i)=>({
                id: i+1,
                title: ['Brute Force','Phishing','Malware','C2 Beacon'][i%4],
                severity: ['High','Medium','Low'][i%3],
                source: ['Firewall','Email Gateway','EDR','Proxy'][i%4],
                time: new Date(Date.now() - i*60000).toISOString()
            }));

            const list = document.getElementById('alerts-list');
            const updated = document.getElementById('td-updated');
            const fHigh = document.getElementById('f-high');
            const fMedium = document.getElementById('f-medium');
            const fLow = document.getElementById('f-low');

            function render(items){
                list.innerHTML = '';
                items.forEach(a=>{
                    const row = document.createElement('div');
                    row.className = 'flex items-center justify-between bg-gray-900/70 border border-gray-700 rounded p-3';
                    row.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="text-xs px-2 py-0.5 rounded font-semibold ${a.severity==='High'?'bg-red-700 text-red-100':a.severity==='Medium'?'bg-orange-700 text-orange-100':'bg-yellow-700 text-yellow-100'}">${a.severity}</span>
                            <div>
                                <div class="text-white text-sm">${a.title}</div>
                                <div class="text-xs text-slate-400">${a.source} · ${new Date(a.time).toLocaleTimeString()}</div>
                            </div>
                        </div>
                        <button onclick="window.location.href='incident-details.html?id=${a.id}'" class="text-xs bg-slate-700 hover:bg-slate-600 text-white px-2 py-1 rounded">Investigate</button>
                    `;
                    list.appendChild(row);
                });
                updated.textContent = new Date().toLocaleString();
            }

            function applyFilters(){
                const active = [];
                if (fHigh.checked) active.push('High');
                if (fMedium.checked) active.push('Medium');
                if (fLow.checked) active.push('Low');
                const filtered = MOCK_ALERTS.filter(a=>active.includes(a.severity));
                render(filtered);
            }

            document.getElementById('td-refresh').addEventListener('click', applyFilters);
            document.getElementById('f-apply').addEventListener('click', applyFilters);
            applyFilters();
        })();
    </script>
        <!-- Load shared particles initializer -->
        <script src="assets/particles-init.js"></script>
        <script src="assets/button-functionality.js"></script>
        <script src="assets/chatbot.js"></script>
</body>
</html>


